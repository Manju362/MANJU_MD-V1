const { default: axios } = require("axios");
const cheerio = require("cheerio");

module.exports = {
  cmd: ["film", "movie", "‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª‡∂¥‡∂ß‡∂∫"],
  help: "·ç® .film ‡∂∏‡∑è‡∂ª‡∂∫‡∑è | ‡∑É‡∑í‡∂±‡∂∏‡∑è ‡∂±‡∂∏‡∂ö‡∑ä",
  desc: "Cinesubz, SinhalaSub, Cineru ‡∑Ä‡∂ú‡∑ö ‡∑Ä‡∑ô‡∂∂‡∑ä ‡∂Ö‡∂©‡∑Ä‡∑í ‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω ‡∂ã‡∂¥‡∑É‡∑í‡∂ª‡∑É‡∑í ‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª‡∂¥‡∂ß ‡∂∂‡∑è‡∂ú‡∑ê‡∂±‡∑ì‡∂∏",
  type: "movie",
  use: "<movie name>",

  async handler(m, { text, conn, args }) {
    if (!text) return m.reply("üìΩÔ∏è ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∑É‡∑ô‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª‡∂¥‡∂ß ‡∂±‡∂∏‡∂ö‡∑ä ‡∂Ω‡∂∂‡∑è‡∂Ø‡∑ô‡∂±‡∑ä‡∂±.\n\n‡∂ã‡∂Ø‡∑è: `.film John Wick 4`");

    const searchUrl = `https://cinesubz.co/?s=${encodeURIComponent(text)}`;
    let res = await axios.get(searchUrl);
    const $ = cheerio.load(res.data);

    const movies = [];
    $("h2.title").each((i, el) => {
      const title = $(el).text().trim();
      const link = $(el).find("a").attr("href");
      if (title && link) {
        movies.push({ title, link });
      }
    });

    if (movies.length === 0) return m.reply("üîç ‡∂ö‡∑í‡∑É‡∑í‡∑Ä‡∂ö‡∑ä ‡∑Ñ‡∂∏‡∑î ‡∂±‡∑ú‡∑Ä‡∑î‡∂´‡∑è. ‡∑Ä‡∑ô‡∂±‡∂≠‡∑ä ‡∂±‡∂∏‡∂ö‡∑ä ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");

    const buttons = movies.slice(0, 5).map((movie, index) => ({
      buttonId: `.getfilm ${movie.link}`,
      buttonText: { displayText: `${index + 1}. ${movie.title}` },
      type: 1,
    }));

    await conn.sendMessage(m.chat, {
      text: `üé¨ "${text}" ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂†‡∑í‡∂≠‡∑ä‚Äç‡∂ª‡∂¥‡∂ß ‡∑Ñ‡∂∏‡∑î ‡∑Ä‡∑í‡∂∫. ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±:`,
      buttons,
      footer: "¬© MANJU_MD Bot",
      headerType: 1,
    }, { quoted: m });
  }
};
